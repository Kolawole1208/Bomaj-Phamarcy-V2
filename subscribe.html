<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bomaj Pharmaceutical - Subscription Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .plan-card {
            transition: transform 0.3s ease;
        }
        .plan-card:hover {
            transform: translateY(-5px);
        }
        .subscription-toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        .subscription-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .toggle-slider {
            background-color: #3b82f6;
        }
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto p-4 md:p-6">
        <!-- Header with User Management -->
        <header class="mb-8">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">Subscription Management System</h1>
                    <p class="text-gray-600 mt-2">Manage multiple users and their subscription plans</p>
                </div>
                <div class="mt-4 md:mt-0">
                    <button onclick="showAddUserModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition flex items-center">
                        <i class="fas fa-user-plus mr-2"></i> Add New User
                    </button>
                </div>
            </div>
            
            <!-- User Selection -->
            <div class="bg-white p-4 rounded-lg shadow mb-6">
                <h2 class="text-lg font-semibold mb-3">Select User to Manage</h2>
                <div id="user-list" class="flex flex-wrap gap-3">
                    <!-- Users will be dynamically added here -->
                </div>
            </div>
        </header>

        <!-- Quick Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-white p-6 rounded-lg shadow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">Total Users</p>
                        <p id="total-users" class="text-2xl font-bold">0</p>
                    </div>
                    <i class="fas fa-users text-blue-500 text-2xl"></i>
                </div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">Active Subscriptions</p>
                        <p id="active-subs" class="text-2xl font-bold">0</p>
                    </div>
                    <i class="fas fa-bell text-green-500 text-2xl"></i>
                </div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">Monthly Revenue</p>
                        <p id="monthly-revenue" class="text-2xl font-bold">$0</p>
                    </div>
                    <i class="fas fa-chart-line text-purple-500 text-2xl"></i>
                </div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600">Plans Available</p>
                        <p id="plans-count" class="text-2xl font-bold">5</p>
                    </div>
                    <i class="fas fa-star text-orange-500 text-2xl"></i>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="bg-white rounded-lg shadow mb-6">
            <div class="border-b">
                <nav class="flex flex-col sm:flex-row">
                    <button class="tab-btn py-4 px-6 text-left font-medium text-blue-600 border-b-2 border-blue-600" onclick="switchTab('news')">
                        <i class="fas fa-newspaper mr-2"></i>News & Alerts
                    </button>
                    <button class="tab-btn py-4 px-6 text-left font-medium text-gray-600 hover:text-blue-600" onclick="switchTab('services')">
                        <i class="fas fa-cogs mr-2"></i>Services
                    </button>
                    <button class="tab-btn py-4 px-6 text-left font-medium text-gray-600 hover:text-blue-600" onclick="switchTab('plans')">
                        <i class="fas fa-star mr-2"></i>Subscription Plans
                    </button>
                    <button class="tab-btn py-4 px-6 text-left font-medium text-gray-600 hover:text-blue-600" onclick="switchTab('users')">
                        <i class="fas fa-users mr-2"></i>All Users
                    </button>
                </nav>
            </div>

            <!-- News Tab -->
            <div id="news-tab" class="tab-content p-6">
                <h2 class="text-2xl font-bold mb-4">News & Alert Subscriptions</h2>
                <p class="text-gray-600 mb-4">Manage news subscriptions for <span id="current-user-name" class="font-semibold">selected user</span></p>
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-4 border rounded-lg">
                        <div>
                            <h3 class="font-semibold">Drug Approval Alerts</h3>
                            <p class="text-sm text-gray-600">FDA and EMA drug approval notifications</p>
                            <span class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded mt-1">Daily</span>
                        </div>
                        <label class="subscription-toggle">
                            <input type="checkbox" id="news1" onchange="toggleNewsSubscription('drugApproval')">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex items-center justify-between p-4 border rounded-lg">
                        <div>
                            <h3 class="font-semibold">Clinical Trial Updates</h3>
                            <p class="text-sm text-gray-600">Latest clinical trial results and phase progress</p>
                            <span class="inline-block bg-green-100 text-green-800 text-xs px-2 py-1 rounded mt-1">Weekly</span>
                        </div>
                        <label class="subscription-toggle">
                            <input type="checkbox" id="news2" onchange="toggleNewsSubscription('clinicalTrials')">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex items-center justify-between p-4 border rounded-lg">
                        <div>
                            <h3 class="font-semibold">Market Intelligence</h3>
                            <p class="text-sm text-gray-600">Pharmaceutical market trends and analysis</p>
                            <span class="inline-block bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded mt-1">Monthly</span>
                        </div>
                        <label class="subscription-toggle">
                            <input type="checkbox" id="news3" onchange="toggleNewsSubscription('marketIntel')">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Services Tab -->
            <div id="services-tab" class="tab-content p-6 hidden">
                <h2 class="text-2xl font-bold mb-4">Professional Services</h2>
                <p class="text-gray-600 mb-4">Manage service subscriptions for <span id="current-user-name-services" class="font-semibold">selected user</span></p>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="border rounded-lg p-4">
                        <h3 class="font-semibold">Regulatory Intelligence</h3>
                        <p class="text-sm text-gray-600 mb-3">AI-powered regulatory pathway analysis</p>
                        <div class="flex justify-between items-center">
                            <span class="text-lg font-bold">$299<span class="text-sm text-gray-600">/month</span></span>
                            <label class="subscription-toggle">
                                <input type="checkbox" id="service1" onchange="toggleServiceSubscription('regulatoryIntel')">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="border rounded-lg p-4">
                        <h3 class="font-semibold">Clinical Trial Design</h3>
                        <p class="text-sm text-gray-600 mb-3">Expert consultation for trial protocols</p>
                        <div class="flex justify-between items-center">
                            <span class="text-lg font-bold">$499<span class="text-sm text-gray-600">/month</span></span>
                            <label class="subscription-toggle">
                                <input type="checkbox" id="service2" onchange="toggleServiceSubscription('trialDesign')">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="border rounded-lg p-4">
                        <h3 class="font-semibold">Market Access Strategy</h3>
                        <p class="text-sm text-gray-600 mb-3">Pricing and reimbursement strategy</p>
                        <div class="flex justify-between items-center">
                            <span class="text-lg font-bold">$399<span class="text-sm text-gray-600">/month</span></span>
                            <label class="subscription-toggle">
                                <input type="checkbox" id="service3" onchange="toggleServiceSubscription('marketAccess')">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Plans Tab -->
            <div id="plans-tab" class="tab-content p-6 hidden">
                <h2 class="text-2xl font-bold mb-4">Subscription Plans</h2>
                <p class="text-gray-600 mb-6">Select a plan for <span id="current-user-name-plans" class="font-semibold">selected user</span></p>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6">
                    <div class="border rounded-lg p-6 plan-card">
                        <h3 class="text-xl font-bold mb-2">Free Trial</h3>
                        <p class="text-gray-600 mb-4">7-day trial access</p>
                        <p class="text-3xl font-bold mb-4">$0<span class="text-lg text-gray-600">/month</span></p>
                        <ul class="space-y-2 mb-6">
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Basic News Alerts</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Limited Access</li>
                            <li class="flex items-center"><i class="fas fa-times text-red-500 mr-2"></i> No Services</li>
                        </ul>
                        <button class="w-full bg-gray-200 text-gray-800 py-2 rounded-lg hover:bg-gray-300 transition" onclick="subscribeToPlan('free')">
                            Start Trial
                        </button>
                    </div>
                    
                    <div class="border rounded-lg p-6 plan-card">
                        <h3 class="text-xl font-bold mb-2">Essential</h3>
                        <p class="text-gray-600 mb-4">Basic news and alerts</p>
                        <p class="text-3xl font-bold mb-4">$49<span class="text-lg text-gray-600">/month</span></p>
                        <ul class="space-y-2 mb-6">
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Daily Drug Alerts</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Weekly Market Digest</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Basic Analytics</li>
                            <li class="flex items-center"><i class="fas fa-times text-red-500 mr-2"></i> Limited Support</li>
                        </ul>
                        <button class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition" onclick="subscribeToPlan('essential')">
                            Subscribe Now
                        </button>
                    </div>
                    
                    <div class="border-2 border-blue-600 rounded-lg p-6 plan-card relative">
                        <div class="absolute -top-3 left-1/2 transform -translate-x-1/2">
                            <span class="bg-blue-600 text-white px-3 py-1 rounded-full text-sm">Most Popular</span>
                        </div>
                        <h3 class="text-xl font-bold mb-2">Professional</h3>
                        <p class="text-gray-600 mb-4">Advanced insights and tools</p>
                        <p class="text-3xl font-bold mb-4">$149<span class="text-lg text-gray-600">/month</span></p>
                        <ul class="space-y-2 mb-6">
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> All Essential Features</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Clinical Trial Intelligence</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Regulatory Dashboard</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Priority Support</li>
                        </ul>
                        <button class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition" onclick="subscribeToPlan('professional')">
                            Subscribe Now
                        </button>
                    </div>
                    
                    <div class="border rounded-lg p-6 plan-card">
                        <h3 class="text-xl font-bold mb-2">Enterprise</h3>
                        <p class="text-gray-600 mb-4">Complete solution for teams</p>
                        <p class="text-3xl font-bold mb-4">$499<span class="text-lg text-gray-600">/month</span></p>
                        <ul class="space-y-2 mb-6">
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> All Professional Features</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Unlimited Users</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Custom Reports</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Dedicated Account Manager</li>
                        </ul>
                        <button class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition" onclick="subscribeToPlan('enterprise')">
                            Subscribe Now
                        </button>
                    </div>
                    
                    <div class="border rounded-lg p-6 plan-card bg-gradient-to-r from-purple-50 to-pink-50">
                        <h3 class="text-xl font-bold mb-2">Custom</h3>
                        <p class="text-gray-600 mb-4">Tailored to your needs</p>
                        <p class="text-3xl font-bold mb-4">Custom<span class="text-lg text-gray-600"> pricing</span></p>
                        <ul class="space-y-2 mb-6">
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Fully Customizable</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> API Access</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> White Label Option</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> 24/7 Premium Support</li>
                        </ul>
                        <button class="w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 transition" onclick="subscribeToPlan('custom')">
                            Contact Sales
                        </button>
                    </div>
                </div>
            </div>

            <!-- Users Tab -->
            <div id="users-tab" class="tab-content p-6 hidden">
                <h2 class="text-2xl font-bold mb-4">All Users</h2>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="p-3 text-left">User</th>
                                <th class="p-3 text-left">Email</th>
                                <th class="p-3 text-left">Current Plan</th>
                                <th class="p-3 text-left">Status</th>
                                <th class="p-3 text-left">Subscriptions</th>
                                <th class="p-3 text-left">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="all-users-table">
                            <!-- Users will be dynamically added here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Current User's Subscription Summary -->
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-2xl font-bold mb-4">Current Subscriptions for <span id="summary-user-name" class="text-blue-600">Selected User</span></h2>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="p-3 text-left">Service/Plan</th>
                            <th class="p-3 text-left">Type</th>
                            <th class="p-3 text-left">Status</th>
                            <th class="p-3 text-left">Next Billing</th>
                            <th class="p-3 text-left">Amount</th>
                            <th class="p-3 text-left">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="subscriptions-table">
                        <!-- Subscriptions will be dynamically added here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="add-user-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
            <div class="p-6">
                <h3 class="text-xl font-bold mb-4">Add New User</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                        <input type="text" id="new-user-name" class="w-full p-2 border rounded-lg" placeholder="John Doe">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="new-user-email" class="w-full p-2 border rounded-lg" placeholder="john@example.com">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Initial Subscription Plan</label>
                        <select id="new-user-plan" class="w-full p-2 border rounded-lg">
                            <option value="free">Free Trial</option>
                            <option value="essential">Essential ($49/month)</option>
                            <option value="professional" selected>Professional ($149/month)</option>
                            <option value="enterprise">Enterprise ($499/month)</option>
                            <option value="custom">Custom (Contact Sales)</option>
                        </select>
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button onclick="hideAddUserModal()" class="px-4 py-2 border rounded-lg hover:bg-gray-50">Cancel</button>
                    <button onclick="addNewUser()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Add User</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Database simulation
        let users = [
            {
                id: 1,
                name: "John Smith",
                email: "john.smith@pharma.com",
                avatarColor: "bg-blue-500",
                currentPlan: "professional",
                subscriptions: [
                    { id: "plan-professional", name: "Professional Plan", type: "plan", status: "active", nextBilling: "2024-03-15", amount: 149 },
                    { id: "service-regulatory", name: "Regulatory Intelligence", type: "service", status: "active", nextBilling: "2024-03-15", amount: 299 },
                    { id: "news-drug", name: "Drug Approval Alerts", type: "news", status: "active", nextBilling: "-", amount: 0 }
                ],
                newsSubscriptions: ["drugApproval"],
                serviceSubscriptions: ["regulatoryIntel"]
            },
            {
                id: 2,
                name: "Sarah Johnson",
                email: "sarah.j@research.org",
                avatarColor: "bg-purple-500",
                currentPlan: "essential",
                subscriptions: [
                    { id: "plan-essential", name: "Essential Plan", type: "plan", status: "active", nextBilling: "2024-03-20", amount: 49 },
                    { id: "news-clinical", name: "Clinical Trial Updates", type: "news", status: "active", nextBilling: "-", amount: 0 }
                ],
                newsSubscriptions: ["clinicalTrials"],
                serviceSubscriptions: []
            }
        ];

        let currentUserId = 1;
        const plans = {
            free: { name: "Free Trial", price: 0, features: ["Basic News Alerts", "Limited Access"] },
            essential: { name: "Essential", price: 49, features: ["Daily Drug Alerts", "Weekly Market Digest", "Basic Analytics"] },
            professional: { name: "Professional", price: 149, features: ["All Essential Features", "Clinical Trial Intelligence", "Regulatory Dashboard", "Priority Support"] },
            enterprise: { name: "Enterprise", price: 499, features: ["All Professional Features", "Unlimited Users", "Custom Reports", "Dedicated Account Manager"] },
            custom: { name: "Custom", price: "Custom", features: ["Fully Customizable", "API Access", "White Label Option", "24/7 Premium Support"] }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            switchTab('news');
            renderUserList();
            selectUser(1);
            updateStats();
        });

        // Tab switching functionality
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('border-blue-600', 'text-blue-600');
                btn.classList.add('text-gray-600');
            });
            
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            event.target.classList.add('border-blue-600', 'text-blue-600');
            event.target.classList.remove('text-gray-600');
        }

        // User Management
        function renderUserList() {
            const userList = document.getElementById('user-list');
            userList.innerHTML = '';
            
            users.forEach(user => {
                const isActive = user.id === currentUserId;
                userList.innerHTML += `
                    <button onclick="selectUser(${user.id})" class="flex items-center space-x-3 p-3 rounded-lg border ${isActive ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:bg-gray-50'}">
                        <div class="user-avatar ${user.avatarColor}">
                            ${user.name.charAt(0)}
                        </div>
                        <div class="text-left">
                            <p class="font-medium">${user.name}</p>
                            <p class="text-sm text-gray-600">${plans[user.currentPlan].name} Plan</p>
                        </div>
                        ${isActive ? '<i class="fas fa-check text-blue-500"></i>' : ''}
                    </button>
                `;
            });
        }

        function selectUser(userId) {
            currentUserId = userId;
            const user = users.find(u => u.id === userId);
            
            // Update UI for current user
            document.querySelectorAll('[id*="current-user-name"]').forEach(el => {
                el.textContent = user.name;
            });
            document.getElementById('summary-user-name').textContent = user.name;
            
            // Update subscription toggles
            updateSubscriptionToggles(user);
            
            // Render subscriptions table
            renderSubscriptionsTable(user);
            
            // Update user list
            renderUserList();
            updateStats();
        }

        function updateSubscriptionToggles(user) {
            // Reset all toggles
            document.querySelectorAll('#news-tab input[type="checkbox"]').forEach(cb => cb.checked = false);
            document.querySelectorAll('#services-tab input[type="checkbox"]').forEach(cb => cb.checked = false);
            
            // Set news subscriptions
            user.newsSubscriptions.forEach(news => {
                const checkbox = document.querySelector(`#news-tab input[onchange*="${news}"]`);
                if (checkbox) checkbox.checked = true;
            });
            
            // Set service subscriptions
            user.serviceSubscriptions.forEach(service => {
                const checkbox = document.querySelector(`#services-tab input[onchange*="${service}"]`);
                if (checkbox) checkbox.checked = true;
            });
        }

        function renderSubscriptionsTable(user) {
            const table = document.getElementById('subscriptions-table');
            table.innerHTML = '';
            
            user.subscriptions.forEach(sub => {
                const statusClass = sub.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
                const typeBadge = sub.type === 'plan' ? 'bg-blue-100 text-blue-800' : 
                                 sub.type === 'service' ? 'bg-purple-100 text-purple-800' : 
                                 'bg-gray-100 text-gray-800';
                
                table.innerHTML += `
                    <tr class="border-b">
                        <td class="p-3">${sub.name}</td>
                        <td class="p-3"><span class="px-2 py-1 rounded text-xs ${typeBadge}">${sub.type}</span></td>
                        <td class="p-3"><span class="px-2 py-1 rounded text-sm ${statusClass}">${sub.status}</span></td>
                        <td class="p-3">${sub.nextBilling}</td>
                        <td class="p-3">${sub.amount === 0 ? 'Free' : '$' + sub.amount.toFixed(2)}</td>
                        <td class="p-3">
                            <button onclick="unsubscribe('${sub.id}')" class="text-red-600 hover:text-red-800">
                                <i class="fas fa-times mr-1"></i> Unsubscribe
                            </button>
                        </td>
                    </tr>
                `;
            });
        }

        // Subscription Management
        function toggleNewsSubscription(newsType) {
            const user = users.find(u => u.id === currentUserId);
            const checkbox = event.target;
            
            if (checkbox.checked) {
                if (!user.newsSubscriptions.includes(newsType)) {
                    user.newsSubscriptions.push(newsType);
                    // Add to subscriptions list
                    const newsItem = getNewsItem(newsType);
                    user.subscriptions.push({
                        id: `news-${newsType}`,
                        name: newsItem.name,
                        type: 'news',
                        status: 'active',
                        nextBilling: '-',
                        amount: 0
                    });
                    showNotification(`Added ${newsItem.name} subscription`, 'success');
                }
            } else {
                const index = user.newsSubscriptions.indexOf(newsType);
                if (index > -1) {
                    user.newsSubscriptions.splice(index, 1);
                    // Remove from subscriptions list
                    user.subscriptions = user.subscriptions.filter(sub => sub.id !== `news-${newsType}`);
                    showNotification(`Removed ${getNewsItem(newsType).name} subscription`, 'info');
                }
            }
            
            renderSubscriptionsTable(user);
            updateStats();
        }

        function toggleServiceSubscription(serviceType) {
            const user = users.find(u => u.id === currentUserId);
            const checkbox = event.target;
            
            if (checkbox.checked) {
                if (!user.serviceSubscriptions.includes(serviceType)) {
                    user.serviceSubscriptions.push(serviceType);
                    // Add to subscriptions list
                    const serviceItem = getServiceItem(serviceType);
                    user.subscriptions.push({
                        id: `service-${serviceType}`,
                        name: serviceItem.name,
                        type: 'service',
                        status: 'active',
                        nextBilling: getNextBillingDate(),
                        amount: serviceItem.price
                    });
                    showNotification(`Added ${serviceItem.name} service`, 'success');
                }
            } else {
                const index = user.serviceSubscriptions.indexOf(serviceType);
                if (index > -1) {
                    user.serviceSubscriptions.splice(index, 1);
                    // Remove from subscriptions list
                    user.subscriptions = user.subscriptions.filter(sub => sub.id !== `service-${serviceType}`);
                    showNotification(`Removed ${getServiceItem(serviceType).name} service`, 'info');
                }
            }
            
            renderSubscriptionsTable(user);
            updateStats();
        }

        function subscribeToPlan(planType) {
            const user = users.find(u => u.id === currentUserId);
            
            // Remove existing plan subscription
            user.subscriptions = user.subscriptions.filter(sub => sub.type !== 'plan');
            
            // Add new plan
            user.currentPlan = planType;
            user.subscriptions.push({
                id: `plan-${planType}`,
                name: `${plans[planType].name} Plan`,
                type: 'plan',
                status: 'active',
                nextBilling: getNextBillingDate(),
                amount: typeof plans[planType].price === 'number' ? plans[planType].price : 0
            });
            
            showNotification(`Subscribed to ${plans[planType].name} Plan`, 'success');
            renderSubscriptionsTable(user);
            renderUserList();
            updateStats();
        }

        function unsubscribe(subscriptionId) {
            const user = users.find(u => u.id === currentUserId);
            const subscription = user.subscriptions.find(sub => sub.id === subscriptionId);
            
            if (subscription) {
                if (subscription.type === 'news') {
                    const newsType = subscriptionId.replace('news-', '');
                    user.newsSubscriptions = user.newsSubscriptions.filter(n => n !== newsType);
                } else if (subscription.type === 'service') {
                    const serviceType = subscriptionId.replace('service-', '');
                    user.serviceSubscriptions = user.serviceSubscriptions.filter(s => s !== serviceType);
                } else if (subscription.type === 'plan') {
                    user.currentPlan = 'free';
                }
                
                user.subscriptions = user.subscriptions.filter(sub => sub.id !== subscriptionId);
                showNotification(`Unsubscribed from ${subscription.name}`, 'info');
                renderSubscriptionsTable(user);
                updateSubscriptionToggles(user);
                renderUserList();
                updateStats();
            }
        }

        // Helper functions
        function getNewsItem(type) {
            const newsItems = {
                drugApproval: { name: "Drug Approval Alerts" },
                clinicalTrials: { name: "Clinical Trial Updates" },
                marketIntel: { name: "Market Intelligence" }
            };
            return newsItems[type] || { name: "Unknown News" };
        }

        function getServiceItem(type) {
            const serviceItems = {
                regulatoryIntel: { name: "Regulatory Intelligence", price: 299 },
                trialDesign: { name: "Clinical Trial Design", price: 499 },
                marketAccess: { name: "Market Access Strategy", price: 399 }
            };
            return serviceItems[type] || { name: "Unknown Service", price: 0 };
        }

        function getNextBillingDate() {
            const date = new Date();
            date.setMonth(date.getMonth() + 1);
            return date.toISOString().split('T')[0];
        }

        function updateStats() {
            const totalUsers = users.length;
            let activeSubscriptions = 0;
            let monthlyRevenue = 0;
            
            users.forEach(user => {
                activeSubscriptions += user.subscriptions.length;
                user.subscriptions.forEach(sub => {
                    if (sub.amount > 0) {
                        monthlyRevenue += sub.amount;
                    }
                });
            });
            
            document.getElementById('total-users').textContent = totalUsers;
            document.getElementById('active-subs').textContent = activeSubscriptions;
            document.getElementById('monthly-revenue').textContent = '$' + monthlyRevenue.toFixed(2);
            document.getElementById('plans-count').textContent = Object.keys(plans).length;
            
            // Update All Users tab
            renderAllUsersTable();
        }

        function renderAllUsersTable() {
            const table = document.getElementById('all-users-table');
            table.innerHTML = '';
            
            users.forEach(user => {
                const status = user.subscriptions.length > 0 ? 'Active' : 'Inactive';
                const statusClass = status === 'Active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800';
                
                table.innerHTML += `
                    <tr class="border-b">
                        <td class="p-3">
                            <div class="flex items-center space-x-3">
                                <div class="user-avatar ${user.avatarColor}">
                                    ${user.name.charAt(0)}
                                </div>
                                <div>
                                    <p class="font-medium">${user.name}</p>
                                </div>
                            </div>
                        </td>
                        <td class="p-3">${user.email}</td>
                        <td class="p-3">${plans[user.currentPlan].name}</td>
                        <td class="p-3"><span class="px-2 py-1 rounded text-sm ${statusClass}">${status}</span></td>
                        <td class="p-3">${user.subscriptions.length}</td>
                        <td class="p-3">
                            <button onclick="selectUser(${user.id})" class="text-blue-600 hover:text-blue-800 mr-3">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteUser(${user.id})" class="text-red-600 hover:text-red-800">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
        }

        // User CRUD operations
        function showAddUserModal() {
            document.getElementById('add-user-modal').classList.remove('hidden');
            document.getElementById('add-user-modal').classList.add('flex');
        }

        function hideAddUserModal() {
            document.getElementById('add-user-modal').classList.add('hidden');
            document.getElementById('add-user-modal').classList.remove('flex');
        }

        function addNewUser() {
            const name = document.getElementById('new-user-name').value;
            const email = document.getElementById('new-user-email').value;
            const plan = document.getElementById('new-user-plan').value;
            
            if (!name || !email) {
                showNotification('Please fill in all fields', 'error');
                return;
            }
            
            const colors = ['bg-blue-500', 'bg-green-500', 'bg-purple-500', 'bg-orange-500', 'bg-pink-500'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            
            const newUser = {
                id: users.length + 1,
                name: name,
                email: email,
                avatarColor: randomColor,
                currentPlan: plan,
                subscriptions: [
                    {
                        id: `plan-${plan}`,
                        name: `${plans[plan].name} Plan`,
                        type: 'plan',
                        status: 'active',
                        nextBilling: getNextBillingDate(),
                        amount: typeof plans[plan].price === 'number' ? plans[plan].price : 0
                    }
                ],
                newsSubscriptions: [],
                serviceSubscriptions: []
            };
            
            users.push(newUser);
            hideAddUserModal();
            showNotification(`Added new user: ${name}`, 'success');
            renderUserList();
            selectUser(newUser.id);
            updateStats();
            
            // Clear form
            document.getElementById('new-user-name').value = '';
            document.getElementById('new-user-email').value = '';
            document.getElementById('new-user-plan').value = 'professional';
        }

        function deleteUser(userId) {
            if (users.length <= 1) {
                showNotification('Cannot delete the last user', 'error');
                return;
            }
            
            if (confirm('Are you sure you want to delete this user?')) {
                const userName = users.find(u => u.id === userId).name;
                users = users.filter(u => u.id !== userId);
                
                if (currentUserId === userId) {
                    currentUserId = users[0].id;
                    selectUser(currentUserId);
                }
                
                showNotification(`Deleted user: ${userName}`, 'info');
                renderUserList();
                updateStats();
            }
        }

        // Notification function
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${
                type === 'success' ? 'bg-green-100 text-green-800 border border-green-200' : 
                type === 'error' ? 'bg-red-100 text-red-800 border border-red-200' : 
                'bg-blue-100 text-blue-800 border border-blue-200'
            }`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} mr-2"></i>
                    <span>${message}</span>
                    <button class="ml-4" onclick="this.parentElement.parentElement.remove()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;<!DOCTYPE html>
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 3000);
        }
    </script>
</body>
</html>
